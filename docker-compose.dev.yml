# Docker Compose para desarrollo con hot-reload
# Uso: docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
# 
# Este archivo extiende docker-compose.yml agregando:
# - Volúmenes para montar el código fuente (hot-reload)
# - Comando con --reload para recargar automáticamente
# - Variables de entorno de desarrollo

services:
  pipe-backend:
    # Montar el código fuente como volumen para hot-reload
    # NOTA: Los volúmenes nombrados (pipe_uploads, pipe_analyses) se heredan del docker-compose.yml
    volumes:
      - pipe_uploads:/app/databases/uploads
      - pipe_analyses:/app/data/analyses
      # Montar código fuente para desarrollo (hot-reload)
      # Usar :rw (read-write) para permitir que uvicorn detecte cambios
      - ./backend/src:/app/src:rw
      - ./backend/main.py:/app/main.py:rw
      - ./backend/index_docs.py:/app/index_docs.py:rw
      - ./backend/langgraph.json:/app/langgraph.json:rw
    # Sobrescribir comando para usar --reload
    command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
    environment:
      # Cambiar a desarrollo
      APP_ENV: development
      DEBUG: "true"
